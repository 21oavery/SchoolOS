<!DOCTYPE html>
<html>

<head>
<script>
window.onload = function() {
    var getTerm = function(id) {
        var winE = document.getElementById(id);
        var xMax = Math.floor((winE.width - 5) / 18);
        var yMax = Math.floor((winE.height - 27) / 30);
        var win = winE.getContext("2d");
        var xPos = 0;
        var yPos = 0;
        var mem = new Uint16Array(xMax * yMax);
        var isCursorVisable;
        var curBlink;
        var blinkInterval;
        var blinkFunct;
        var api = {
            "setCursorVisable": function(v) {
                isCursorVisable = v ? true : false;
                if (isCursorVisable) {
                    curBlink = true;
                    blinkInterval = setInterval(blinkFunct, 500);
                    api.redraw();
                } else {
                    clearInterval(blinkInterval);
                    api.redraw();
                }
            },
            "getSize": function() {
                return [xMax, yMax];
            },
            "setCursorPos": function(x, y) {
                xPos = x;
                yPos = y;
            },
            "getCursorPos": function() {
                return [xPos, yPos];
            },
            "clear": function() {
                for (let i = 0; i < mem.length; ++i) {
                    mem[i] = 32;
                }
            },
            "write": function(s) {
                for (let i = 0; i < s.length; ++i) {
                    mem[xPos + yPos * xMax] = s.charCodeAt(i);
                    ++xPos;
                    if (xPos >= xMax) {
                        xPos = 0;
                        ++yPos;
                        if (yPos >= yMax) {
                            --yPos;
                            api.scroll();
                        }
                    }
                }
            },
            "scroll": function() {
                for (let i = 0; i < (yMax - 1); ++i) {
                    for (let j = 0; j < xMax; ++j) {
                        mem[i * xMax + j] = textMatrix[i * xMax + xMax + j];
                    }
                }
                for (let j = 0; j < xMax; ++j) {
                    mem[(yMax - 1) * xMax + j] = 32;
                }
            },
            "redraw": function() {
                win.fillStyle = "#000000";
                win.fillRect(0, 0, winE.width, winE.height);
                win.fillStyle = "#FFFFFF";
                win.font = "30px Lucida Console";
                win.textAlign = "left";
                for (let i = 0; i < yMax; ++i) {
                    let line = "";
                    for (let j = 0; j < xMax; ++j) {
                        line += String.fromCharCode(mem[i * xMax + j]);
                    }
                    win.fillText(line, 5, i * 30 + 27);
                }
                if (isCursorVisable && curBlink && (xPos < xMax)) {
                    win.fillText("_", xPos * 18 + 5, yPos * 30 + 27);
                }
            }
        };
        blinkFunct = function() {
            curBlink = !curBlink;
            api.redraw();
        };
        api.clear();
        api.redraw();
        api.setCursorVisable(true);
        return api;
    };
    var getKeyboard = function() {
        var api = {
            "addListener": function(f) {
                return document.addEventListener("keypress", f);
            }
        };
        return api;
    };
    //var read = function(t, k) {
    //    var start = t.getCursorPos();
    //    var end = t.get
    var t = getTerm("win");
    var k = getKeyboard();
    t.write("User: ");
    var size = t.getSize();
    k.addListener(function(e) {
        if (e.))
};
</script>
</head>

<body>
<canvas id="win" width=640 height=480><!--35, 16-->
</body>

</html>
